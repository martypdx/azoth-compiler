{"version":3,"file":"findTemplates.js","sources":["../src/findTemplates.js"],"sourcesContent":["import parseTaggedTemplate from './parseTaggedTemplate';\nimport { ancestor, base } from 'acorn/dist/walk';\n\nconst noNestedTTE = Object.assign( base, { TaggedTemplateExpression(){} } );\n\nexport default function findTemplates( ast, tag ) {\n\tconst templates = [];\n\tancestor( ast, {\n\t\tTaggedTemplateExpression( node, ancestors ) {\n\t\t\tif( node.tag.name !== tag ) return;\n\t\t\tconst scope = getFnScope( ancestors );\n\t\t\tconst { html, bindings } = parseTaggedTemplate( node.quasi, scope.params );\n\t\t\ttemplates.push( { html, bindings, scope, node } );\n\t\t}\n\t}, noNestedTTE );\n\treturn templates;\n}\n\nconst isFn = /function/i;\n\nfunction getFnScope( ancestors ) {\n\t// current child node is in stack, so -2\n\tlet i = ancestors.length - 2;\n\tlet node = null;\n\twhile( node = ancestors[i--] ) {\n\t\tif ( isFn.test( node.type ) ) return makeScope( node );\n\t}\n}\n\nfunction makeScope( scope ) {\n\tconst result = {\n\t\tparams: Object.create( null ),\n\t\tplucks: [],\n\t\tstart: scope.start,\n\t\tend: scope.end\n\t}\n\tscope.params.reduce( ( hash, param, i ) => {\n\t\tif ( param.type === 'Identifier' ) hash[ param.name ] = true;\n\t\telse if( param.type === 'ObjectPattern' ) {\n\t\t\tparam.properties.forEach( p => {\n\t\t\t\tconsole.log( p );\n\t\t\t\tconst pluck = { key: p.key.name, index: i };\n\t\t\t\tresult.plucks.push( pluck );\n\t\t\t\thash[ `__ref${i}` ] = true;\n\t\t\t});\n\t\t}\n\t\treturn hash;\n\t}, result.params );\n\n\treturn result;\n}\n\n"],"names":[],"mappings":";;;;;kBAKwB;;AALxB;;;;AACA;;;;AAEA,MAAM,cAAc,OAAO,MAAP,aAAqB,EAAE,2BAA0B,CAAE,CAA9B,EAArB,CAApB;;AAEe,SAAS,aAAT,CAAwB,GAAxB,EAA6B,GAA7B,EAAmC;AACjD,OAAM,YAAY,EAAlB;AACA,qBAAU,GAAV,EAAe;AACd,2BAA0B,IAA1B,EAAgC,SAAhC,EAA4C;AAC3C,OAAI,KAAK,GAAL,CAAS,IAAT,KAAkB,GAAtB,EAA4B;AAC5B,SAAM,QAAQ,WAAY,SAAZ,CAAd;AACA,SAAM,EAAE,IAAF,EAAQ,QAAR,KAAqB,mCAAqB,KAAK,KAA1B,EAAiC,MAAM,MAAvC,CAA3B;AACA,aAAU,IAAV,CAAgB,EAAE,IAAF,EAAQ,QAAR,EAAkB,KAAlB,EAAyB,IAAzB,EAAhB;AACA;AANa,EAAf,EAOG,WAPH;AAQA,QAAO,SAAP;AACA;;AAED,MAAM,OAAO,WAAb;;AAEA,SAAS,UAAT,CAAqB,SAArB,EAAiC;;AAEhC,KAAI,IAAI,UAAU,MAAV,GAAmB,CAA3B;AACA,KAAI,OAAO,IAAX;AACA,QAAO,OAAO,UAAU,GAAV,CAAd,EAA+B;AAC9B,MAAK,KAAK,IAAL,CAAW,KAAK,IAAhB,CAAL,EAA8B,OAAO,UAAW,IAAX,CAAP;AAC9B;AACD;;AAED,SAAS,SAAT,CAAoB,KAApB,EAA4B;AAC3B,OAAM,SAAS;AACd,UAAQ,OAAO,MAAP,CAAe,IAAf,CADM;AAEd,UAAQ,EAFM;AAGd,SAAO,MAAM,KAHC;AAId,OAAK,MAAM;AAJG,EAAf;AAMA,OAAM,MAAN,CAAa,MAAb,CAAqB,CAAE,IAAF,EAAQ,KAAR,EAAe,CAAf,KAAsB;AAC1C,MAAK,MAAM,IAAN,KAAe,YAApB,EAAmC,KAAM,MAAM,IAAZ,IAAqB,IAArB,CAAnC,KACK,IAAI,MAAM,IAAN,KAAe,eAAnB,EAAqC;AACzC,SAAM,UAAN,CAAiB,OAAjB,CAA0B,KAAK;AAC9B,YAAQ,GAAR,CAAa,CAAb;AACA,UAAM,QAAQ,EAAE,KAAK,EAAE,GAAF,CAAM,IAAb,EAAmB,OAAO,CAA1B,EAAd;AACA,WAAO,MAAP,CAAc,IAAd,CAAoB,KAApB;AACA,SAAO,SAAO,CAAE,GAAhB,IAAsB,IAAtB;AACA,IALD;AAMA;AACD,SAAO,IAAP;AACA,EAXD,EAWG,OAAO,MAXV;;AAaA,QAAO,MAAP;AACA"}